# Data

```{r, include = FALSE}
library(tidyverse)
library(redav)
library(knitr)
library(ggplot2)
library(dplyr)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}

#load ev data
df_charging_stations <- read.csv('data/ev_charging_stations_seoul.csv')
df_ev_info <- read.csv('data/ev_info_seoul.csv')


# 1. Charging Stations vs Electric Vehicles per District
# Count the number of charging stations per district in df_charging_stations
charging_stations_count <- df_charging_stations %>%
  group_by(District) %>%
  summarise(Charging_Stations = n())

# Merge this with df_ev_info
df_merged <- merge(df_ev_info, charging_stations_count, by = "District")

# Create the plot
ggplot(df_merged, aes(x = Count, y = Charging_Stations)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("Number of Electric Vehicles") +
  ylab("Number of Charging Stations") +
  ggtitle("Charging Stations vs Electric Vehicles per District")


```

Charging Stations vs Electric Vehicles per District Plot:

This plot also indicates a positive correlation between the number of electric vehicles and the number of charging stations in each district.
The positive slope of the line of best fit suggests that districts with more electric vehicles tend to have more charging stations. This is an expected trend, as more EVs would naturally drive the need for more charging infrastructure.
There is, however, significant spread around the line of best fit, indicating that the ratio of charging stations to electric vehicles is not consistent across all districts. Some districts may be underserved relative to the number of EVs, while others may have a surplus of charging stations.
The plot suggests that while there is an overall trend towards matching the number of charging stations with the number of electric vehicles, there may be inefficiencies or imbalances in certain areas that could be addressed for better service provision.


```{r, echo=FALSE, warning=FALSE, message=FALSE}

# 2. Population Density vs Electric Vehicle Density
ggplot(df_ev_info, aes(x = Population, y = Count)) +
  geom_point() +
  geom_smooth(method = "lm") +
  xlab("Population") +
  ylab("Number of Electric Vehicles") +
  ggtitle("Population Density vs Electric Vehicle Density")

```

Population Density vs Electric Vehicle Density Plot:

This plot shows a positive correlation between population size and the number of electric vehicles, which means that generally, as the population of a district increases, so does the number of electric vehicles in that district.
However, the distribution of points suggests that the relationship is not perfectly linear, and there are districts with relatively high populations that do not have as many electric vehicles as might be expected. Similarly, there are districts with a lower population that have a high number of electric vehicles.
The confidence interval (shaded area) indicates variability around the line of best fit, suggesting that population size is not the only factor influencing the number of electric vehicles in a district.



```{r, echo=FALSE, warning=FALSE, message=FALSE}

df_merged$Stations_to_EV_Ratio <- df_merged$Charging_Stations / df_merged$Count

ggplot(df_merged, aes(x = reorder(District, Stations_to_EV_Ratio), y = Stations_to_EV_Ratio)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  xlab("District") +
  ylab("Charging Stations to EV Ratio") +
  ggtitle("Charging Stations to EV Ratio per District")


```
Charging Stations to EV Ratio per District:

This graph provides insight into whether there are enough charging stations to meet the needs of the number of electric vehicles in each district. A lower ratio indicates better accessibility.
```{r, echo=FALSE, warning=FALSE, message=FALSE}

df_merged$EV_Per_Capita <- df_merged$Count / df_merged$Population
ggplot(df_merged, aes(x = reorder(District, -EV_Per_Capita), y = EV_Per_Capita)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  xlab("District") +
  ylab("EV Penetration Rate (EVs per Capita)") +
  ggtitle("EV Penetration Rate per District")



```
EV Penetration Rate per District:

This graph shows the number of EVs per capita, indicating how common EVs are in each district.

```{r, echo=FALSE, warning=FALSE, message=FALSE}

ggplot(df_merged, aes(x = Population, y = Charging_Stations, size = Count)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(name = "Number of EVs") +
  xlab("Population") +
  ylab("Number of Charging Stations") +
  ggtitle("Charging Infrastructure vs. Population Density with EV Overlay")


```
Charging Infrastructure vs. Population Density Scatter Plot with EV Overlay:

This scatter plot can help visualize the relationship between the population density of each district and the density of the charging infrastructure, with the size of the points representing the number of EVs.


```{r, echo=FALSE, warning=FALSE, message=FALSE}

df_merged$Charging_Station_Accessibility <- df_merged$Charging_Stations / df_merged$Population

library(ggplot2)
library(geojsonio)

# Read GeoJSON data from a URL
seoul_geo <- geojson_read("https://raw.githubusercontent.com/southkorea/seoul-maps/master/kostat/2013/json/seoul_municipalities_geo_simple.json", what = "sp")

# Convert to an sf object and calculate centroids
seoul_geo_sf <- st_as_sf(seoul_geo)
seoul_centroids <- st_centroid(seoul_geo_sf)
# Extract coordinates and convert to a data frame
centroids_coords <- as.data.frame(st_coordinates(seoul_centroids))
# Add the coordinates as new columns to the seoul_centroids sf object
seoul_centroids$long <- centroids_coords$X
seoul_centroids$lat <- centroids_coords$Y

# Merge district data with centroids
district_data_sf <- merge(df_merged,seoul_centroids, by.x = "District", by.y = "name_eng")

# Create the heatmap
ggplot() +
  geom_sf(data = seoul_geo_sf, fill = NA, color = "black") +  # Draw the municipality boundaries
  geom_tile(data = district_data_sf, aes(x = long, y = lat, fill = Charging_Station_Accessibility), color = "white") +
  scale_fill_gradient(low = "yellow", high = "red") +  # Set the colors for the heatmap
  coord_sf() +  # Use coordinate system of sf
  theme_minimal() +
  ggtitle("Heatmap of Charging Stations in Seoul") #------ it doesnt work

# Create a heatmap-like scatter plot
ggplot() +
  geom_sf(data = seoul_geo_sf, fill = NA, color = "black") +  # Draw the municipality boundaries
  geom_point(data = district_data_sf, aes(x = long, y = lat, size = Charging_Station_Accessibility, color = Charging_Station_Accessibility), alpha = 0.6) +
  scale_size(range = c(2, 10)) + 
  scale_color_viridis_c() +  
  coord_sf() +  # Use coordinate system of sf
  theme_minimal() +
  ggtitle("Heatmap of Charging Stations in Seoul")


```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
##categotical visualizations

# Visualization 1: Distribution of Charger Types by District
ggplot(df_charging_stations, aes(x=reorder(District, District, function(x)-length(x)), fill=Charger.type)) +
  geom_bar() +
  labs(title="Distribution of Charger Types by District in Seoul", x="District", y="Count") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Visualization 2: Availability of Rapid Charging Options
rapid_charging_data <- df_charging_stations %>% 
  mutate(RapidCharging = ifelse(grepl('Rapid', Rapid.charging.amount), 'Rapid Charging', 'Standard Charging')) %>%
  count(RapidCharging)

ggplot(rapid_charging_data, aes(x="", y=n, fill=RapidCharging)) +
  geom_bar(stat="identity", width=1) +
  coord_polar(theta="y") +
  labs(title="Availability of Rapid Charging Options in Seoul", x="", y="") +
  theme_void()

# Visualization 3: Relationship Between Operating Institution and Charger Type
ggplot(df_charging_stations, aes(x=Operating.institution, fill=Charger.type)) +
  geom_bar(position="fill") +
  labs(title="Operating Institution vs. Charger Type in Seoul", x="Operating Institution", y="Proportion") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Visualization 4: Large vs. Small Facility Classifications
ggplot(df_charging_stations, aes(x=District, fill=Facility.classification..large.)) +
  geom_bar(position="stack") +
  labs(title="Large vs. Small Facility Classifications in Seoul Districts", x="District", y="Count") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```
Distribution of Charger Types by District: A grouped bar chart showing the count of each charger type in each district. This could highlight if certain districts favor particular charger types.

Availability of Rapid Charging Options: A pie chart showing the proportion of charging stations offering rapid charging. This can indicate how well the city caters to the need for quick charging.

Relationship Between Operating Institution and Charger Type: A clustered bar chart showing the frequency of each charger type operated by different institutions. This can reveal if certain institutions prefer specific types of chargers.

Comparison of Large vs. Small Facility Classifications for Charging Stations: A stacked bar chart showing the proportion of large vs. small facility classifications in each district. This might indicate trends in how space is utilized for EV charging facilities.